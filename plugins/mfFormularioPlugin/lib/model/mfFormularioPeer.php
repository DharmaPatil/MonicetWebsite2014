<?php


/**
 * Skeleton subclass for performing query and update operations on the 'mf_formulario' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.5.0-dev on:
 *
 * Thu Feb 25 16:32:06 2010
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.plugins.mfFormularioPlugin.lib.model
 */
class mfFormularioPeer extends BasemfFormularioPeer {
  public static function filtrar($formulario, $utilizador_id = null){
  	$utilizador_id = is_null($utilizador_id) ? sfContext::getInstance()->getUser()->getGuardUser()->getId() : $utilizador_id;
  	
  	$regras = mfFormularioQuery::create('f')->
  	  where('f.Regra LIKE ?', get_class($formulario).'%');
  	  
  	  if ( $formulario->getObject()->isNew() ){
  	  	$regras = $regras->filterByAoCriar(true);
  	  }else{
  	  	$regras = $regras->filterByAoEditar(true);
  	  }
  	  
    $regras = $regras->addAscendingOrderByColumn(mfFormularioPeer::VISIVEL, 'asc')->
  	  usemfFormularioUtilizadorQuery()->
  	    filterByUtilizadorId($utilizador_id)->
  	  enduse()->
  	  find();
  	
  	foreach( $regras as $regra ){
  		if( ! $regra->getVisivel() ){
  			$formulario->unsetAllFields($regra->getCamposAsArray());
  		}else{
  			$formulario->unsetAllFieldsExcept($regra->getCamposAsArray());
  		}
  	}
  }
}