<?php


/**
 * Skeleton subclass for performing query and update operations on the 'watchman' table.
 *
 * 
 *
 * This class was autogenerated by Propel 1.5.0-dev on:
 *
 * Wed Oct 19 17:11:57 2011
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class WatchmanPeer extends BaseWatchmanPeer {
	
	public static function doSelectListByCompany() {
        $user = sfContext::getInstance()->getUser()->getGuardUser();
        $company = CompanyPeer::doSelectUserCompany($user->getId());
        $c = new Criteria();
        if ($company) {
            $c->add(WatchmanPeer::COMPANY_ID, $company->getId(), Criteria::EQUAL);
        }
        return mfUtils::fromObjectsToArrayWithEmpty(self::doSelect($c));
    }

    public static function doSelectByCompany() {
        $user = sfContext::getInstance()->getUser()->getGuardUser();
        $company = CompanyPeer::doSelectUserCompany($user->getId());
        if ($company) {
            $query = WatchmanQuery::create()
                ->filterByCompanyId($company->getId())
                ->paginate();
        } else {
            $query = WatchmanQuery::create()
                ->paginate();
        }
        return $query;
    }
    
    public static function getWatchmanByNome($nome){
      $c = new Criteria();
      $c->add(WatchmanPeer::NAME, $nome, Criteria::LIKE);
      $s = WatchmanPeer::doSelect($c);
      if(count($s)){
        return $s[0];
      }
      else{
        return false;
      }
    }
    
    public static function getByNameAndCompanyAcronym($watchman_name, $company_acronym){
      return WatchmanQuery::create()
              ->filterByName($watchman_name)
              ->useCompanyQuery()
                ->filterByAcronym($company_acronym)
              ->endUse()
              ->findOne();
    }
    
    
    public static function doSelect(Criteria $criteria, PropelPDO $con = null)
    {
      $user = sfContext::getInstance()->getUser()->getGuardUser();
      $company = CompanyPeer::doSelectUserCompany($user->getId());
      if ($company) {
          $criteria->addAnd(WatchmanPeer::COMPANY_ID, $company->getId(), Criteria::EQUAL);
      }
      $criteria->addJoin(WatchmanPeer::COMPANY_ID, CompanyPeer::ID, Criteria::LEFT_JOIN);
      
      $criteria->addAscendingOrderByColumn(CompanyPeer::NAME);
      $criteria->addAscendingOrderByColumn(WatchmanPeer::NAME);
      return WatchmanPeer::populateObjects(WatchmanPeer::doSelectStmt($criteria, $con));
    }
    
    
    public static function doCount(Criteria $criteria, $distinct = false, PropelPDO $con = null)
    {
      return count(WatchmanPeer::doSelect($criteria));
    }
} // WatchmanPeer
